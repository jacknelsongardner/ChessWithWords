/**
 * initAnalytics is added to all Devvit apps which use web views.
 *
 * This sends interaction events to the parent window via postMessage.
 * These metrics are used to inform app performance and feed ranking.
 */
export const initAnalytics = () => {
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupTracking, { once: true });
    }
    else {
        setupTracking();
    }
};
const setupTracking = () => document.addEventListener('pointerdown', () => postWebViewInternalMessage({
    scope: 0,
    type: 'devvit-internal',
    analytics: { event: 'click' },
}), {
    passive: true,
});
const postWebViewInternalMessage = (internalMessage) => parent.postMessage(internalMessage, '*');
initAnalytics();
globalThis.addEventListener('load', () => {
    const timeStart = performance.timeOrigin;
    const duration = performance.now();
    const timeEnd = performance.timeOrigin + duration;
    postWebViewInternalMessage({
        scope: 0,
        type: 'devvit-internal',
        analytics: { event: 'web-view-loaded', timeStart, timeEnd, duration },
    });
});
