syntax = "proto3";

package reddit.xpaymentsplatform.payapi.v1;

import "google/protobuf/timestamp.proto";
import "reddit/xpaymentsplatform/payapi/v1/common.proto";

option go_package = "github.snooguts.net/reddit/payments-api/api/xpaymentsplatform/payapipb/v1;payapipb";

message GetGoldBalancesRequest {
  Environment environment = 1;
  string user_id = 2 [deprecated = true]; // DEPRECATED t2_id of the user whose gold balances are being requested.
  bool include_earned_gold = 3;
  bool include_spendable_gold = 4;
  bool include_earned_gold_transactions = 5;
  // bool include_spendable_gold_transactions = 6; // Not supported yet

  oneof owner_id {
    string user = 30; // t2_id of the user whose gold balances are being requested.
    string subreddit = 35; // t5_id of the subreddit whose gold balances are being requested.
  }

  optional string request_initiator_id = 98; // t2_id of the user initiated the API request.
  CallerID caller_id = 99; // This is the ID of the service that is calling this API.
}

message GetGoldBalancesResponse {
  Environment environment = 1;
  GoldBalance earned_gold = 2;
  GoldBalance spendable_gold = 3;
}

message GoldBalance {
  int32 available = 1;
  int32 total = 2;
  GoldTransactionsConnection transactions_connection = 3;
}

message GoldTransactionsConnection {
  repeated GoldTransaction transactions = 1;
  PageInfo page_info = 2;
}

message GoldTransaction {
  // string id = 1; // Reserved to support pagination
  Product product = 2; // Only product_type will be populated [payOrders]
  // Price paid for the product by the buyer at the time of purchase [payPayments]
  // checkout_price.amount is the Gold amount paid by 'from_user_id' to 'to_user_id
  ProductPrice checkout_price = 3;

  bool is_anonymous = 4;
  string from_user_id = 5; // May be null if anonymous
  // string to_user_id = 6; // Reserved. user_id present inside GetGoldBalancesRequest

  google.protobuf.Timestamp date = 7;
}
