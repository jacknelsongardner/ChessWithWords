syntax = "proto3";

package reddit.devvit.subreddit.v1;

import "reddit/devvit/ads/v1/ads.proto";
import "reddit/devvit/subreddit/v1/context_action.proto";

option go_package = "github.snooguts.net/reddit/devplatform-api/go/grpc/devvit/subreddit/v1;devvit_subreddit_manifest";

message DevvitSubredditManifestRequest {
  // t5_ subreddit id, eg 't5_bogzxg'
  string subreddit = 1;
}

message BatchDevvitSubredditManifestRequest {
  // List of t5_ subreddit ids to get the manifest for. eg ['t5_bogzxg', 't5_cpqfxh']
  repeated string subreddit_ids = 1;
}

message DevvitSubredditManifest {
  // List of all context actions available in the Subreddit
  repeated SubredditContextActions context_actions = 1;
  // List of all app installations in the Subreddit
  repeated Installation installations = 2;
  // Not actually used
  repeated ErrorMessage errors = 3 [deprecated = true];
  // Error message if an error occurred while fetching the manifest
  ErrorMessage error = 4;
}

message BatchDevvitSubredditManifestResponse {
  // List of all Subreddit manifests, returned in the same order as the
  // requested subreddit ids
  repeated DevvitSubredditManifest manifests = 1;
}

message SubredditContextActions {
  // The hostname corresponding to the context actions, eg '7c65897c-d3d1-4070-9db3-25402e093d37.sf-local-app.main.devvit-gateway.reddit.com'
  string hostname = 1;
  // Return value from ContextAction.GetActions()
  ContextActionList actions = 2;
}

message Installation {
  // Installation unique identifier, eg 'b4d7a045-5771-410a-b8ca-bd21eb869578'
  string installation_id = 1;
  // The installation's public api version, eg '0.10.24' or '0.11.0-next-2024-08-28-c7054fdb3.0'
  string public_api_version = 2;
  // The name of the host running this installation, eg '7c65897c-d3d1-4070-9db3-25402e093d37.sf-local-app.main.devvit-gateway.reddit.com'
  string hostname = 3;
  // Specific information about the app in this installation
  App app = 4;
  // fully-qualified URL to fetch the code bundle for this installation, e.g.
  // 'https://devvit-gateway.reddit.com/bundles/b4d7a045-5771-410a-b8ca-bd21eb869578/main/0.0.30'
  string bundle_url = 5;
  // The location of the installation, which is a t5_ subreddit id, eg 't5_bogzxg'
  string location = 6;
}

message App {
  // App unique identifier, eg '04adab23-60c0-467d-9958-948cea1ff6be'
  string id = 1;
  // App slug, eg 'my-devvit-app'
  string slug = 2;
  // App name, eg 'My Devvit App'
  string name = 3;
  // The visibility of the app (PUBLIC, PRIVATE, or UNLISTED)
  AppVisibility visibility = 4;
  // Information about the app owner
  AppOwner owner = 5;
  // The app version, eg '1.2.3'
  string version = 6;
  // Configuration related to ads
  reddit.devvit.ads.v1.AdsConfig ads_config = 7;
}

message AppOwner {
  // t2_ userId of the app owner, eg 't2_11t51216bu'
  string user_id = 1;
  // Username of the app owner, eg 'slowcooked99'
  string user_name = 2;
}

enum AppVisibility {
  PUBLIC = 0;
  PRIVATE = 1;
  UNLISTED = 2;
}

message ErrorMessage {
  string message = 1;
}
