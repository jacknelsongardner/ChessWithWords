syntax = "proto3";

package reddit.coreplatform.sensitive.v1;

import "google/protobuf/any.proto";

option go_package = "github.snooguts.net/reddit/thing-api/go/grpc/sensitive/v1;sensitive";
option java_multiple_files = true;
option java_outer_classname = "WrappersProto";
option java_package = "com.reddit.coreplatform.api.sensitive.v1";

// This message represents an encrypted payload. This message is intended to be supplied to the private-storage
// service for decryption. If the encryption of this value is time bound, then it can no longer be decrypted after its key expires.
// Callers attempting to decrypt a value must have sufficient permission for the namespace this value belongs to.
message EncryptedBytes {
  // The ID of the key that is able to decrypt this value.
  string key_id = 1;

  // The ACL namespace of the value. This is used to scope values to specific domains and enforce authorization constraints.
  string namespace = 2;

  // The encrypted bytes of the value.
  bytes value = 3;
}

// This message is used to represent a string whose contents may be contextually sensitive. It is meant to allow
// transferring a value across trust boundaries in a secure manner.
message SensitiveString {
  // Value can be either the plain decrypted string value, or a secured encrypted bytes message.
  oneof value {
    // The raw, decrypted string value.
    string decrypted = 1;
    // The encrypted representation of the string. If the encryption of this value is time bound, then this
    // value will become unreadable after its encryption key expires.
    EncryptedBytes encrypted = 2;
  }
}

// This message is used to represent a protobuf message whose contents may be contextually sensitive. It is meant to allow
// transferring a value across trust boundaries in a secure manner.
message SensitiveMessage {
  // Value can be either the plain decrypted anypb value, or a secured encrypted bytes message.
  oneof value {
    // The raw, decrypted anypb value.
    google.protobuf.Any decrypted = 1;

    // The encrypted representation of the anypb. If the encryption of this value is time bound, then this
    // value will become unreadable after its encryption key expires.
    EncryptedBytes encrypted = 2;
  }
}
