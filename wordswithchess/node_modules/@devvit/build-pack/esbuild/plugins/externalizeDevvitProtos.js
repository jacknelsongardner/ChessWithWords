/**
 * Plugin for externalizing `@devvit/protos` imports from the bundle. This is done as a plugin rather than using
 * the `external` option in the build config to ensure we only externalize the root of the @devvit/protos package.
 * Other imports like @devvit/protos/payments.js will still be bundled.
 *
 * @param disableExternDevvitProtos -- If true, the plugin will not externalize @devvit/protos.
 * @returns
 */
export function externalizeDevvitProtos(disableExternDevvitProtos) {
    return {
        name: 'externalizeDevvitProtos',
        setup(build) {
            if (!disableExternDevvitProtos) {
                build.onResolve({ filter: /^@devvit\/protos$/, namespace: 'file' }, (args) => {
                    return {
                        path: args.path,
                        external: true,
                    };
                });
            }
        },
    };
}
